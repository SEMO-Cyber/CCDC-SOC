<agent_config>

  <!-- ================================================================
       SYSTEM INVENTORY (required for vulnerability detection)
       ================================================================ -->
  <wodle name="syscollector">
    <disabled>no</disabled>
    <interval>30m</interval>
    <scan_on_start>yes</scan_on_start>
    <hardware>yes</hardware>
    <os>yes</os>
    <network>yes</network>
    <packages>yes</packages>
    <ports all="yes">yes</ports>
    <processes>yes</processes>
    <hotfixes>yes</hotfixes>
    <synchronization>
      <max_eps>10</max_eps>
    </synchronization>
  </wodle>

  <!-- ================================================================
       FILE INTEGRITY MONITORING (FIM)
       ================================================================ -->
  <syscheck>
    <frequency>120</frequency>
    <scan_on_start>yes</scan_on_start>
    <alert_new_files>yes</alert_new_files>
    <auto_ignore frequency="10" timeframe="3600">no</auto_ignore>

    <!-- System binaries -->
    <directories check_all="yes" whodata="yes">/bin</directories>
    <directories check_all="yes" whodata="yes">/sbin</directories>
    <directories check_all="yes" whodata="yes">/usr/bin</directories>
    <directories check_all="yes" whodata="yes">/usr/sbin</directories>
    <directories check_all="yes" whodata="yes">/usr/local/bin</directories>
    <directories check_all="yes" whodata="yes">/usr/local/sbin</directories>

    <!-- Boot and kernel -->
    <directories check_all="yes" whodata="yes">/boot</directories>
    <directories check_all="yes" whodata="yes">/lib/modules</directories>
    <directories check_all="yes" whodata="yes">/lib64</directories>

    <!-- Critical auth and identity files -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/passwd</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/shadow</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/group</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/gshadow</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/hosts</directories>

    <!-- Privilege escalation targets -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/sudo.conf</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/sudo*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/sudoers.d/*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/pam.d/*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/ld.so.preload</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/ld.so.conf</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/ld.so.conf.d/*</directories>

    <!-- SSH config -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/ssh/*</directories>

    <!-- Cron (persistence) -->
    <directories check_all="yes" realtime="yes" report_changes="yes" whodata="yes">/etc/cron*</directories>
    <directories check_all="yes" realtime="yes" report_changes="yes" whodata="yes">/var/spool/cron</directories>

    <!-- Systemd (persistence) -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/systemd/*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/usr/lib/systemd/system</directories>

    <!-- Network config -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/*net*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/iptables/*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/nftables*</directories>

    <!-- Web server configs -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/nginx</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/httpd/*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/apache2/*</directories>

    <!-- Web roots — realtime for webshell detection -->
    <directories realtime="yes" check_all="yes" report_changes="yes" whodata="yes">/var/www</directories>

    <!-- Logging config (detect tampering) -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/rsyslog*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/syslog*</directories>

    <!-- Wazuh self-protection -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/var/ossec/etc</directories>

    <!-- SSSD / name service -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/sssd/*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/nsswitch.conf</directories>

    <!-- User shell configs -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/root</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/home/*/.bash*</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/home/*/.profile</directories>
    <directories check_all="yes" report_changes="yes" whodata="yes">/home/*/.ssh</directories>

    <!-- Misc config -->
    <directories check_all="yes" report_changes="yes" whodata="yes">/etc/nanorc</directories>

    <!-- Ignore noisy paths -->
    <ignore>/etc/mtab</ignore>
    <ignore>/etc/hosts.deny</ignore>
    <ignore>/etc/hosts.allow</ignore>
    <ignore>/etc/random-seed</ignore>
    <ignore>/etc/resolv.conf</ignore>
    <ignore>/etc/adjtime</ignore>
    <ignore>/etc/utmpx</ignore>
    <ignore>/etc/wtmpx</ignore>
    <ignore type="sregex">/var/lib/dpkg</ignore>
    <ignore type="sregex">/var/lib/rpm</ignore>
    <ignore type="sregex">/var/lib/yum</ignore>
    <ignore type="sregex">/var/cache/yum</ignore>
    <ignore type="sregex">/var/lib/dnf</ignore>
    <ignore type="sregex">/var/cache/dnf</ignore>
    <ignore type="sregex">/var/lib/pacman</ignore>
    <ignore type="sregex">/var/lib/apk</ignore>
    <ignore>/var/log</ignore>
    <ignore>/var/ossec/logs</ignore>
    <!-- Ignore Wazuh queue/DB churn -->
    <ignore>/var/ossec/queue</ignore>
    <ignore>/var/ossec/var</ignore>

    <whodata>
      <provider>audit</provider>
    </whodata>
  </syscheck>

  <!-- ================================================================
       SECURITY CONFIGURATION ASSESSMENT
       ================================================================ -->
  <sca>
    <enabled>yes</enabled>
    <scan_on_start>yes</scan_on_start>
    <interval>30m</interval>
    <skip_nfs>yes</skip_nfs>
  </sca>

  <!-- ================================================================
       LOG COLLECTION (minimal — Splunk handles full aggregation)
       ================================================================ -->

  <!-- Auth / security (needed for MITRE-mapped detection rules) -->
  <localfile>
    <location>/var/log/auth.log</location>
    <log_format>syslog</log_format>
  </localfile>
  <localfile>
    <location>/var/log/secure</location>
    <log_format>syslog</log_format>
  </localfile>

  <!-- Audit (needed for whodata FIM and MITRE-mapped rules) -->
  <localfile>
    <location>/var/log/audit/audit.log</location>
    <log_format>audit</log_format>
  </localfile>

</agent_config>
