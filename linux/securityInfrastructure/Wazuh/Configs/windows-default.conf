<agent_config>

  <!-- ================================================================
       SYSTEM INVENTORY (required for vulnerability detection)
       ================================================================ -->
  <wodle name="syscollector">
    <disabled>no</disabled>
    <interval>30m</interval>
    <scan_on_start>yes</scan_on_start>
    <hardware>yes</hardware>
    <os>yes</os>
    <network>yes</network>
    <packages>yes</packages>
    <ports all="yes">yes</ports>
    <processes>yes</processes>
    <hotfixes>yes</hotfixes>
    <synchronization>
      <max_eps>10</max_eps>
    </synchronization>
  </wodle>

  <!-- ================================================================
       FILE INTEGRITY MONITORING (FIM)
       ================================================================ -->
  <syscheck>
    <frequency>120</frequency>
    <scan_on_start>yes</scan_on_start>
    <alert_new_files>yes</alert_new_files>
    <auto_ignore frequency="10" timeframe="3600">no</auto_ignore>

    <!-- System executables -->
    <directories check_all="yes" realtime="yes">C:\Windows\System32</directories>
    <directories check_all="yes" realtime="yes">C:\Windows\SysWOW64</directories>

    <!-- Critical Windows config -->
    <directories check_all="yes" report_changes="yes" realtime="yes">C:\Windows\System32\drivers\etc</directories>
    <directories check_all="yes" report_changes="yes" realtime="yes">C:\Windows\System32\GroupPolicy</directories>

    <!-- Startup / persistence locations -->
    <directories check_all="yes" realtime="yes">C:\Users\*\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</directories>
    <directories check_all="yes" realtime="yes">C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup</directories>

    <!-- Scheduled tasks -->
    <directories check_all="yes" realtime="yes">C:\Windows\System32\Tasks</directories>

    <!-- PowerShell profiles (persistence) -->
    <directories check_all="yes" report_changes="yes" realtime="yes">C:\Windows\System32\WindowsPowerShell\v1.0</directories>
    <directories check_all="yes" report_changes="yes" realtime="yes">C:\Users\*\Documents\WindowsPowerShell</directories>

    <!-- Web roots if IIS is present -->
    <directories check_all="yes" realtime="yes" report_changes="yes">C:\inetpub\wwwroot</directories>

    <!-- Wazuh self-protection -->
    <directories check_all="yes" report_changes="yes">C:\Program Files (x86)\ossec-agent\ossec.conf</directories>

    <!-- Windows registry monitoring -->
    <windows_registry arch="both">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</windows_registry>
    <windows_registry arch="both">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce</windows_registry>
    <windows_registry arch="both">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDLLs</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon</windows_registry>
    <windows_registry>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</windows_registry>

    <!-- Ignore noisy paths -->
    <ignore>C:\Windows\System32\LogFiles</ignore>
    <ignore>C:\Windows\Temp</ignore>
    <ignore type="sregex">.log$|.tmp$</ignore>
  </syscheck>

  <!-- ================================================================
       SECURITY CONFIGURATION ASSESSMENT
       ================================================================ -->
  <sca>
    <enabled>yes</enabled>
    <scan_on_start>yes</scan_on_start>
    <interval>30m</interval>
  </sca>

  <!-- ================================================================
       LOG COLLECTION — Windows Event Channels
       ================================================================ -->

  <!-- Security events (needed for MITRE-mapped detection rules) -->
  <!-- Key events: 4624/4625 logon, 4662 DCSync, 4688 process creation,
       4697/7045 service install, 4698/4699 sched task, 4769 Kerberoast,
       5140/5145 share/pipe access -->
  <localfile>
    <location>Security</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- System events (Event 7045: new service installed — PsExec detection) -->
  <localfile>
    <location>System</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Sysmon (process/network/file/pipe/registry MITRE-mapped detection) -->
  <localfile>
    <location>Microsoft-Windows-Sysmon/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- PowerShell script block logging (Event 4104 — credential theft, C2) -->
  <localfile>
    <location>Microsoft-Windows-PowerShell/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- WMI activity (Events 5857-5861 — WMIExec, WMI persistence) -->
  <localfile>
    <location>Microsoft-Windows-WMI-Activity/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Task Scheduler (Events 106/200/201 — ATExec, scheduled task abuse) -->
  <localfile>
    <location>Microsoft-Windows-TaskScheduler/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

  <!-- Windows Defender (malware detections, tamper attempts) -->
  <localfile>
    <location>Microsoft-Windows-Windows Defender/Operational</location>
    <log_format>eventchannel</log_format>
  </localfile>

</agent_config>
